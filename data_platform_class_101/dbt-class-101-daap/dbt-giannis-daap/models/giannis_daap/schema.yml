version: 2

sources:
  - name: example_source
    schema: giannis_daap_raw
    tables:
      - name: customers
      - name: orders
      - name: payments
        description: "External table of Transmission header (HDR)"
        external:
          location: "@GIANNIS_DAAP_RAW.PAYMENTS_STAGE"
          file_format: "( TYPE = csv, FIELD_DELIMITER=',' SKIP_HEADER = 1)"
          auto_refresh: true
          pattern: '.*payments.*'

        columns:
          - name: id
            data_type: varchar(35)
            description: "Payment Id"
          - name: order_id
            data_type: varchar(35)
            description: "ORDER ID relationship"
          - name: payment_method
            data_type: varchar(25)
            description: "Sender type"
          - name: amount
            data_type: varchar(35)
            description: "Payment Amount"


models:
  - name: t_customers_orders
    description: This table has basic information about a customer,aswellassome derived facts based on a customer's orders
    columns:
      - name: customer_id
        description: This is a unique identifier for a customer
        tests:
          - not_null
          - unique

      - name: first_name
        description: Customer's first name. PII.

      - name: last_name
        description: Customer's last name. PII.

      - name: first_order
        description: Date (UTC) of a customer's first order

      - name: most_recent_order
        description: Date (UTC) of a customer's most recent order

      - name: number_of_orders
        description: Count of the number of orders a customer has placed

      - name: total_order_amount
        description: Total value (AUD) of a customer's orders


  - name: t_orders_payments
    description: This table has basic information about orders,aswellassome derived facts based on payments
    columns:
      - name: order_id
        tests:
          - unique
          - not_null
        description: This is a unique identifier for an order

      - name: customer_id
        description: Foreign key to the customers table
        tests:
          - not_null
          - relationships:
              to: ref('customers')
              field: id

      - name: order_date
        description: Date (UTC) that the order was placed

      - name: status
        description: '{{ doc("orders_status") }}' 
        tests:
          - accepted_values:
              values: ['placed', 'shipped', 'completed', 'return_pending', 'returned']

      - name: amount
        description: Total amount (AUD) of the order
        tests:
          - not_null

      - name: credit_card_amount
        description: Amount of the order (AUD) paid for by credit card
        tests:
          - not_null

      - name: coupon_amount
        description: Amount of the order (AUD) paid for by coupon
        tests:
          - not_null

      - name: bank_transfer_amount
        description: Amount of the order (AUD) paid for by bank transfer
        tests:
          - not_null

      - name: gift_card_amount
        description: Amount of the order (AUD) paid for by gift card
        tests:
          - not_null


  - name: v_order_payments_per_month
    description: Monthly number of orders



